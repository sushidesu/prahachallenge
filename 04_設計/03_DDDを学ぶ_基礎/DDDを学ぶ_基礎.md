# DDDを学ぶ (基礎)

## 課題1

### エンティティ

ドメインモデルを表現したものの一種。識別子で同一判定を行う。可変。

### 値オブジェクト (バリューオブジェクト)

ドメインモデルを表現したものの一種。保持する値で同一判定を行う。不変。

### 集約

強い整合性が必要なドメインオブジェクトの集まり。レポジトリとのやり取りは必ず集約単位で行うため、トランザクションは必ず1つになる。

集約内のオブジェクト間の参照はインスタンス参照、集約をまたぐオブジェクト間の参照はID参照を使用する。

> 「必ず守りたい強い整合性を持ったオブジェクトのまとまり」
>
> 「実践ドメイン駆動設計 モデリング/実装ガイド」 P38

### ユビキタス言語

ドメインモデルを探求する中で発見された言葉のこと。言い換えによる意味の損失や認識の齟齬を防ぐために、コード上はもちろん、会話でもその言葉を使うことが求められる。

> 発見したモデルの言葉を、すべての場所で使うという指針です。
>
> 「実践ドメイン駆動設計 モデリング/実装ガイド P16」

### 境界づけられたコンテキスト

モデルが適用される範囲を定めること。大規模なシステムやプロジェクトの中でモデルを統一することは困難なため、適切に範囲を制限する必要がある。

> あるモデルを、同じ意味で使い続ける範囲を定義するものです。
>
> 「実践ドメイン駆動設計 モデリング/実装ガイド P17」

### ドメイン

領域のこと。DDDにおいては、特に「問題解決したい領域」のことを指す。DDDの原則の1つに「コアドメインに集中すること」とあるように、DDD実践時には第1にこの(コア)ドメインの機能向上を意識する。

> 「ソフトウェアで問題解決しようとする対象領域」を「ドメイン」と呼びます。
>
> 「実践ドメイン駆動設計 モデリング/実装ガイド P11」

> 根本的には、DDDを駆動している原則は次の3つだけです。
>
> - コアドメインに集中すること
> - ドメインの実践者とソフトウェアの実践者による創造的な共同作業を通じて、モデルを探求すること
> - 明示的な境界づけられたコンテキストの内部で、ユビキタス言語を語ること。
>
> 「エリック・エヴァンスのドメイン駆動設計 [日本語版への序文] より」

### ドメインサービス

エンティティや値オブジェクトとしては表しづらいものをドメインサービスとして表現する。 (集約をまたぐ操作や、他のオブジェクトに対する問い合わせなど)

### リポジトリ

ドメインオブジェクトの永続化(取得、保存)を扱う。永続化の際は必ず集約単位で行う。

### アプリケーション

ドメインオブジェクトやドメインサービスを組み合わせてユースーケースを実現する。

### CQRS

コマンドクエリ責務分離のこと。集約をまたいだデータやパフォーマンスのための特別な対応が必要なときに、参照専用のモデルを別途定義する。参照用のモデル・取得を行うためのインターフェースはユースケース層に定義し、インフラ層で実装を行う。

### DTO

Data Transfar Objectの略。ユースケース層 -> プレゼンテーション層へのデータの受け渡しの際に、このDTOに詰め替えて受け渡すことが推奨されている。

## 課題2 (クイズ)

### クイズ1

集約は大きいほうが良いか？小さい方が良いか？

<details><summary>回答例</summary>

なるべく小さいほうが良い。必ず集約単位で永続化を行う必要があるため、大きすぎる集約はロックを取る範囲も大きくなってしまう。
</details>

### クイズ2

Primitive型ではなく値オブジェクトを使用するメリットは何でしょうか？

<details><summary>回答例</summary>

- 凝集度が高まるので、変更に強くなる。(振る舞いの拡張も簡単になる)
- 専用の型がつくので、値の受け渡し時の間違いがなくなる
</details>

### クイズ3

モデル分離 (CQRS) と データソース分離は違うものです。その違いは何ですか？それぞれがどのような課題を解決しますか？

<details><summary>回答例</summary>

| | データソース分離 | モデル分離 |
| --- | --- | --- |
| 違い | 用途によって、参照するDB、インスタンスやテーブルを分ける | 読み取り用のモデル(クラス)、書き込み用のクラスを分ける |

- 解決する問題
    - データソース分離
        - **パフォーマンスの課題を解決**
        - 参照系のインスタンスと更新系と分けることで、片方のみスケールアウトできる
            - スケールアウト(台数を増やす)
            - スケールアップ (個々の能力を上げる)
        - マテリアルビューを用いるのもデータソース分離の一種
        - 書き込みをNoSQL任せて高速化
    - モデル分離
        - **主にアプリケーションの複雑さを解消**
        - クエリを柔軟に書ける→パフォーマンスの改善にもつながる
</details>
